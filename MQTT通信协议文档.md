## 项目说明
本项目是一个基于Spring Boot和MQTT的校园饮水系统后端，主要功能是：
1. 接收硬件设备（饮水机）发送的数据并存储到数据库
2. 提供两个查询接口给前端：
   - 按学生姓名查询饮水量
   - 按饮水机ID查询饮水量
   -
## 数据流向
```
硬件设备 -> MQTT消息 -> 后端程序 -> 数据库
前端查询 <- MQTT消息 <- 后端程序 <- 数据库
```

# MQTT通信协议文档

## 一、前端通信

### 1. 按姓名查询饮水记录
- **订阅主题**：`pubNameData`
- **发送格式**：
```json
{
    "name": "张三"
}
```
- **返回主题**：`subCard`
- **返回格式**：
```json
[
    {
        "id": ,        
        "time": "09:30:00",
        "drink": 100
    }
]
```
- **错误返回**：
```json
{
    "error": "饮水卡不存在"
}
```

### 2. 按饮水机ID查询饮水记录
- **订阅主题**：`pubIdData`
- **发送格式**：
```json
{
    "id": 1
}
```
- **返回主题**：`subRIDdata`
- **返回格式**：
```json
[
    {
        "id": ,        
        "time": "09:30:00",
        "drink": 100
    }
]
```
- **错误返回**：
```json
{
    "error": "饮水机不存在"
}
```

## 二、硬件通信

### 1. 饮水机数据
- **订阅主题**：`subDispenser`
- **接收格式**：
```json
{    
    "id": 1,             
    "locate": "教学楼A区",
    "TDS": "合格",
    "status": 0
}
```

### 2. 饮水卡数据
- **订阅主题**：`subIDCard`
- **接收格式**：
```json
{
    "id": "001",        
    "time": "09:30:00",
    "drink": 100
}
```

### 3. 饮水记录数据
- **订阅主题**：`subRIDdata`
- **接收格式**：
```json
{
    "time": "09:30:56",
    "id": 1,            
    "drink": 100
}
```

## 三、主题说明

### 订阅主题（需要订阅的主题）
1. `subDispenser` - 饮水机数据
2. `subIDCard` - 饮水卡数据
3. `subRIDdata` - 饮水记录数据
4. `subTip` - 故障信息
5. `pubNameData` - 按姓名查询请求
6. `pubIdData` - 按ID查询请求

### 发布主题（服务器会发布到这些主题）
1. `subCard` - 按姓名查询结果
2. `subRidDataPub` - 按ID查询结果

## 四、注意事项

1. 所有时间格式均为 "HH:mm:ss"
2. 饮水机ID为整数类型
3. 饮水卡ID为字符串类型
4. 饮水量（drink）为整数类型，单位为毫升
5. 故障信息（tip）只有两种状态：
   - Error1: 严重故障
   - Warning1: 警告信息
6. 饮水机状态（status）：
   - 0: 正常
   - 1: 故障
   - 2: 维护中